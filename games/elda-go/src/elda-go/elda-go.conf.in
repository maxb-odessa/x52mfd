#
# simple elda config
#
# block must start with bare keyword
# block data must start with blank
#
#              
#

source
    handler stdin
    name IN

source
    name JOURNAL
    handler filein
    var dir @HOME@/.ed/journal/
    var mask ^Journal\.\d+\.\d+\.log$

action
    name XDOLOCAL
    handler xdo            
    var display :0.0          
    var window edpad-text

action
    name LOG
    handler fileout
    var path @HOME@/.ed/elda-go.log
    var truncate yes
    var create yes

action
    name OUT
    handler stdout

source
    name TICK10S
    handler ticker
    var interval 10
    var message tick 10 seconds

#source
#    name PIPE
#    handler pipein
#    var path /tmp/elda-go-out.pipe

#action
#    name PIPE
#    handler pipeout
#    var path /tmp/x52-in.pipe

#action
#    name IGAU
#    handler igau
#    var url https://igau.some.url.here
#    var api_token 12345

action
    name EDSM-POST-JOURNAL
    handler edsm
    var url             https://www.edsm.net/api-journal-v1
    var api_key         1111111 
    var commander       me11111
    var software_name   test
    var software_ver    0.0.1

#source
#    name EDSM-GET-BODIES
#    handler edsm
#    var url             https://www.edsm.net/api-system-v1/bodies




# $0 = whole match string, $1..$9 = submatches (if any)

#event
#    source IN .*
#    action IGAU $0
#    action EDSM-SEND AAA $0



# TEST!!
# 
#event
#    source EDSM-GET-BODIES .+
#    action OUT got from EDSM $0


event
    source JOURNAL "event":"(StartJump|FSDJump|FSDTarget|Scan|SAASignalsFound)",
    action EDSM-POST-JOURNAL $0

event
    source JOURNAL "event":"FSSDiscoveryScan".+"BodyCount":([0-9]+), "NonBodyCount":([0-9]+),
    action OUT mfd 3 "Signals: $1/$2"
    action OUT update
    action LOG | Signals:    $1/$2\n

event
    source TICK10S tick 10 seconds
    action OUT clock local 24hr ddmmyy
    action OUT update

event
    source JOURNAL "event":"FSDJump", "Taxi":false,
    action OUT bri led 30%
    action OUT bri mfd 30%
    action OUT update

event
    source JOURNAL "event":"StartJump", "JumpType":"Hyperspace", "StarSystem":"([a-zA-Z -]+) ([a-zA-Z]{1}\d+-?\d*)",.+"StarClass":"(\w)"
    action OUT mfd 2 " $3,$2"
    action OUT bri led 5%
    action OUT bri mfd 5%
    action OUT update

event
    source JOURNAL "event":"FSDTarget", "Name":"([a-zA-Z -]+) ([a-zA-Z]{1}\d+-?\d*)", .+"StarClass":"(.+)", "RemainingJumpsInRoute":(\d+)
    action OUT mfd 1 "~$3,$2 ($4)"
    action OUT mfd 3 "not scanned"
    action OUT update
    action LOG \n\n
    action LOG  Next Jump Target: $3, $2, Jumps left: $4\n

event
    source JOURNAL "event":"Scan", "ScanType":".+", "BodyName":"([a-zA-Z -]+) ([a-zA-Z]{1}\d+-?\d*)(| [aA]+)", .+"StarType":"(\w+)", "Subclass":(\d+), .+"WasDiscovered":(\w+), "
    action OUT mfd 2 " $4,$2,$6"
    action OUT update
    action LOG \n
    action LOG | Class:      $4$5\n
    action LOG | Name:       $1 $2\n
    action LOG | Discovered: $6\n

event
    source JOURNAL "event":"Scan", "ScanType":".+", "BodyName":"([a-zA-Z -]+) ([a-zA-Z]{1}\d+-?\d*) [0-9b-zB-Z ]+", .+"StarType":"(\w+)", "Subclass":(\d+), .+"WasDiscovered":(\w+), "
    action LOG |-> Star: $3$4\n

event
    source JOURNAL "event":"DockingGranted",
    action OUT blink on
    action OUT update

event
    source JOURNAL "event":"Docked",
    action OUT blink off
    action OUT update

event
    source JOURNAL "event":"SAASignalsFound", "BodyName":"(.+)", "SystemAddress":.+"Signals":\[.+"Guardian", "Count":(\d+)
    action LOG |-> Body: $1, Guardian signals: $2\n

event
    source JOURNAL "event":"SAASignalsFound", "BodyName":"(.+)", "SystemAddress":.+"Signals":\[.+"Human", "Count":(\d+)
    action LOG |-> Body: $1, Human signals: $2\n

event
    source JOURNAL "event":"FSSSignalDiscovered",.+"SignalName_Localised":\s?"Nonhuman signal source",
    action LOG |-> NonHuman signal found\n

event
    source JOURNAL "event":"FSSSignalDiscovered",.+"SignalName_Localised":\s?"Notable stellar phenomena"
    action LOG |-> Stellar Phenomena found\n

event
    source JOURNAL "event":"FSSSignalDiscovered",.+"SignalName_Localised":\s?"CAPITAL SHIP"
    action LOG |-> Capital Ship detected\n

event
    source IN ^CONNECTED$
    action OUT mfd 1 "Hello,"
    action OUT mfd 2 " commander"
    action OUT mfd 3 "  Vessae!"
    action OUT bri led 30% 
    action OUT bri mfd 30%
    action OUT blink off
    action OUT led a red
    action OUT led b red
    action OUT led t1 amber
    action OUT led t2 amber
    action OUT led t3 amber
    action OUT clock local 24hr ddmmyy
    action OUT update


